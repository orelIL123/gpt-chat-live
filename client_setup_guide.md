# מדריך הגדרת לקוח חדש לצ'אטבוט Vegos

מדריך זה מפרט את השלבים הנדרשים להוספת לקוח חדש למערכת הצ'אטבוט, כולל ההגדרות הנדרשות ב-Firebase בצד השרת (עבורך) וקוד ההטמעה שיש לספק לבעל האתר (הלקוח).

## חלק 1: הגדרות ב-Firebase (עבורך)

עבור כל לקוח חדש, יש ליצור הגדרה ייעודית במסד הנתונים של Firebase Firestore. הגדרה זו תשמש את הצ'אטבוט לזהות את הלקוח, לאמת את מקור הבקשות (CORS) ולדעת לאן לשלוח לידים שייתפסו.

1.  **ודא ש-Firebase Firestore מופעל בפרויקט שלך.**
    *   אם עדיין לא עשית זאת, היכנס למסוף Firebase, בחר את הפרויקט שלך, ועבור ללשונית "Firestore Database". לחץ על "Create database" ובחר את המיקום המתאים.

2.  **נווט לקולקציית `brains` ב-Firestore.**
    *   קולקציה זו מכילה את ההגדרות עבור כל "מוח" או "אישיות" של צ'אטבוט, ובמקרה שלנו, את ההגדרות הספציפיות לכל לקוח. אם הקולקציה אינה קיימת, היא תיווצר אוטומטית כאשר תוסיף אליה את המסמך הראשון.

3.  **צור מסמך חדש (Document) בקולקציית `brains` עבור הלקוח החדש.**
    *   **שם המסמך (Document ID):** זהו ה"מזהה הייחודי של הלקוח" (`clientId`). בחר שם קצר, באנגלית, ללא רווחים או תווים מיוחדים (לדוגמה: `mycompany`, `clientname`). שם זה ישמש בהמשך בקוד ההטמעה באתר הלקוח. **חשוב:** שם המסמך הזה הוא ה-`clientId`!
    *   **שדות במסמך:** במסמך זה, הוסף את השדות הבאים:
        *   `leadTargetEmail` (סוג: `string`): כתובת האימייל המלאה (לדוגמה: `leads@clientcompany.com`) אליה המערכת תשלח הודעת אימייל בכל פעם שליד חדש ייתפס על ידי הצ'אטבוט באתר הלקוח.
        *   `allowedOrigins` (סוג: `array` - מערך של `string`): רשימה של כתובות האתרים המלאות (כולל הפרוטוקול `http://` או `https://` והדומיין) בהן מותר להטמיע את קוד הווידג'ט של הצ'אטבוט. זהו מנגנון אבטחה (CORS) שמונע שימוש בווידג'ט מאתרים לא מורשים. יש להוסיף לרשימה את כל הדומיינים והסאב-דומיינים הרלוונטיים של הלקוח (לדוגמה: `https://www.clientwebsite.com`, `https://clientwebsite.com`).

    **דוגמה למסמך בקולקציית `brains` (ה-Document ID הוא `clientwebsite`):**

    ```json
    {
      "leadTargetEmail": "leads@clientwebsite.com",
      "allowedOrigins": [
        "https://www.clientwebsite.com",
        "https://clientwebsite.com"
      ]
    }
    ```

4.  **קולקציית `leads`:** קולקציה זו תשמש לאחסון הנתונים של כל ליד שייתפס (שם, פרטי קשר, היסטוריית שיחה וכו'). קולקציה זו תיווצר ותאוכלס אוטומטית על ידי המערכת כאשר לידים חדשים יתקבלו. אין צורך בהגדרה ידנית של מבנה הקולקציה מראש, אך מומלץ לבדוק את כללי האבטחה (Security Rules) של Firestore כדי לוודא שהגישה לקולקציה זו מאובטחת כראוי.

## חלק 2: הטמעה באתר הלקוח (עבור בעל האתר)

על בעל האתר להוסיף קטע קוד קטן אחד בלבד לקוד ה-HTML של האתר שלו. קטע קוד זה טוען את סקריפט הווידג'ט ומגדיר את מזהה הלקוח הייחודי.

1.  **הוסף את קטע הקוד הבא לקוד ה-HTML של האתר.**
    *   מומלץ להוסיף את הקוד לפני תג הסגירה `</body>` כדי להבטיח שהווידג'ט נטען לאחר שכל שאר תוכן הדף נטען.

    ```html
    <script
      id="vegos-chat-widget-script"
      src="https://gpt-chat-live.vercel.app/public/widget.js"
      data-client-id="YOUR_CLIENT_ID_HERE"
    ></script>
    ```

2.  **החלף את הטקסט `YOUR_CLIENT_ID_HERE`** במזהה הלקוח הייחודי (Document ID) שיצרת עבור הלקוח בקולקציית `brains` ב-Firebase (לדוגמה: `clientwebsite`).

3.  **ודא שכתובת האתר (Origin URL)** בה מוטמע הקוד (לדוגמה: `https://www.clientwebsite.com`) אכן קיימת ברשימת `allowedOrigins` שהגדרת במסמך הלקוח ב-Firebase. אם כתובת האתר אינה ברשימה, הווידג'ט לא יעבוד כראוי עקב חסימת CORS.

לאחר ביצוע שני החלקים הללו (הגדרה ב-Firebase והטמעה באתר הלקוח), הצ'אטבוט אמור להופיע באתר הלקוח ולהיות מוכן לשימוש ולכידת לידים.